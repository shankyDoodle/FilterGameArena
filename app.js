var aStaticMasterData = [
  {
    "api_rate_limit":50000
  },
  {
    "title":"LittleBigPlanet PS Vita",
    "platform":"PlayStation Vita",
    "score":9.0,
    "genre":"Platformer",
    "editors_choice":"Y"
  },
  {
    "title":"LittleBigPlanet PS Vita -- Marvel Super Hero Edition",
    "platform":"PlayStation Vita",
    "score":9.0,
    "genre":"Platformer",
    "editors_choice":"Y"
  },
  {
    "title":"Splice: Tree of Life",
    "platform":"iPad",
    "score":8.5,
    "genre":"Puzzle",
    "editors_choice":"N"
  },
  {
    "title":"NHL 13",
    "platform":"Xbox 360",
    "score":8.5,
    "genre":"Sports",
    "editors_choice":"N"
  },
  {
    "title":"NHL 13",
    "platform":"PlayStation 3",
    "score":8.5,
    "genre":"Sports",
    "editors_choice":"N"
  },
  {
    "title":"Total War Battles: Shogun",
    "platform":"Macintosh",
    "score":7.0,
    "genre":"Strategy",
    "editors_choice":"N"
  },
  {
    "title":"Double Dragon: Neon",
    "platform":"Xbox 360",
    "score":3.0,
    "genre":"Fighting",
    "editors_choice":"N"
  },
  {
    "title":"Guild Wars 2",
    "platform":"PC",
    "score":9.0,
    "genre":"RPG",
    "editors_choice":"Y"
  },
  {
    "title":"Double Dragon: Neon",
    "platform":"PlayStation 3",
    "score":3.0,
    "genre":"Fighting",
    "editors_choice":"N"
  },
  {
    "title":"Total War Battles: Shogun",
    "platform":"PC",
    "score":7.0,
    "genre":"Strategy",
    "editors_choice":"N"
  },
  {
    "title":"Tekken Tag Tournament 2",
    "platform":"PlayStation 3",
    "score":7.5,
    "genre":"Fighting",
    "editors_choice":"N"
  },
  {
    "title":"Tekken Tag Tournament 2",
    "platform":"Xbox 360",
    "score":7.5,
    "genre":"Fighting",
    "editors_choice":"N"
  },
  {
    "title":"Wild Blood",
    "platform":"iPhone",
    "score":7.0,
    "genre":"",
    "editors_choice":"N"
  },
  {
    "title":"Mark of the Ninja",
    "platform":"Xbox 360",
    "score":9.0,
    "genre":"Action, Adventure",
    "editors_choice":"Y"
  },
  {
    "title":"Mark of the Ninja",
    "platform":"PC",
    "score":9.0,
    "genre":"Action, Adventure",
    "editors_choice":"Y"
  },
  {
    "title":"Home: A Unique Horror Adventure",
    "platform":"Macintosh",
    "score":6.5,
    "genre":"Adventure",
    "editors_choice":"N"
  },
  {
    "title":"Home: A Unique Horror Adventure",
    "platform":"PC",
    "score":6.5,
    "genre":"Adventure",
    "editors_choice":"N"
  },
  {
    "title":"Avengers Initiative",
    "platform":"iPhone",
    "score":8.0,
    "genre":"Action",
    "editors_choice":"N"
  },
  {
    "title":"Way of the Samurai 4",
    "platform":"PlayStation 3",
    "score":5.5,
    "genre":"Action, Adventure",
    "editors_choice":"N"
  },
  {
    "title":"JoJo's Bizarre Adventure HD",
    "platform":"Xbox 360",
    "score":7.0,
    "genre":"Fighting",
    "editors_choice":"N"
  },
  {
    "title":"JoJo's Bizarre Adventure HD",
    "platform":"PlayStation 3",
    "score":7.0,
    "genre":"Fighting",
    "editors_choice":"N"
  },
  {
    "title":"Mass Effect 3: Leviathan",
    "platform":"Xbox 360",
    "score":7.5,
    "genre":"RPG",
    "editors_choice":"N"
  },
  {
    "title":"Mass Effect 3: Leviathan",
    "platform":"PlayStation 3",
    "score":7.5,
    "genre":"RPG",
    "editors_choice":"N"
  },
  {
    "title":"Mass Effect 3: Leviathan",
    "platform":"PC",
    "score":7.5,
    "genre":"RPG",
    "editors_choice":"N"
  },
  {
    "title":"Dark Souls (Prepare to Die Edition)",
    "platform":"PC",
    "score":9.0,
    "genre":"Action, RPG",
    "editors_choice":"Y"
  },
  {
    "title":"Symphony",
    "platform":"PC",
    "score":7.0,
    "genre":"Shooter",
    "editors_choice":"N"
  },
  {
    "title":"Bastion",
    "platform":"iPad",
    "score":9.0,
    "genre":"Action, RPG",
    "editors_choice":"Y"
  },
  {
    "title":"Tom Clancy's Ghost Recon Phantoms",
    "platform":"PC",
    "score":7.5,
    "genre":"Shooter",
    "editors_choice":"N"
  },
  {
    "title":"Thirty Flights of Loving",
    "platform":"PC",
    "score":8.0,
    "genre":"Adventure",
    "editors_choice":"N"
  },
  {
    "title":"Legasista",
    "platform":"PlayStation 3",
    "score":6.5,
    "genre":"Action, RPG",
    "editors_choice":"N"
  },
  {
    "title":"The Walking Dead: The Game -- Episode 3: Long Road Ahead",
    "platform":"Macintosh",
    "score":9.0,
    "genre":"Adventure",
    "editors_choice":"Y"
  },
  {
    "title":"World of Warcraft: Mists of Pandaria",
    "platform":"PC",
    "score":8.7,
    "genre":"RPG",
    "editors_choice":"Y"
  },
  {
    "title":"Hell Yeah! Wrath of the Dead Rabbit",
    "platform":"PlayStation 3",
    "score":4.9,
    "genre":"Platformer",
    "editors_choice":"N"
  },
  {
    "title":"Pokemon White Version 2",
    "platform":"Nintendo DS",
    "score":9.6,
    "genre":"RPG",
    "editors_choice":"Y"
  },
  {
    "title":"War of the Roses",
    "platform":"PC",
    "score":7.3,
    "genre":"Action",
    "editors_choice":"N"
  },
  {
    "title":"Pokemon Black Version 2",
    "platform":"Nintendo DS",
    "score":9.6,
    "genre":"RPG",
    "editors_choice":"Y"
  },
  {
    "title":"Drakerider",
    "platform":"iPhone",
    "score":6.5,
    "genre":"RPG",
    "editors_choice":"N"
  },
  {
    "title":"The Walking Dead: The Game -- Episode 3: Long Road Ahead",
    "platform":"Xbox 360",
    "score":9.0,
    "genre":"Adventure",
    "editors_choice":"Y"
  },
  {
    "title":"The Walking Dead: The Game -- Episode 3: Long Road Ahead",
    "platform":"PC",
    "score":9.0,
    "genre":"Adventure",
    "editors_choice":"Y"
  },
  {
    "title":"The Walking Dead: The Game -- Episode 3: Long Road Ahead",
    "platform":"PlayStation 3",
    "score":9.0,
    "genre":"Adventure",
    "editors_choice":"Y"
  },
  {
    "title":"Rock Band Blitz",
    "platform":"Xbox 360",
    "score":8.5,
    "genre":"Music",
    "editors_choice":"Y"
  },
  {
    "title":"Counter-Strike: Global Offensive",
    "platform":"Macintosh",
    "score":8.0,
    "genre":"Shooter",
    "editors_choice":"N"
  },
  {
    "title":"Worms Revolution",
    "platform":"PlayStation 3",
    "score":8.5,
    "genre":"Strategy",
    "editors_choice":"N"
  },
  {
    "title":"Worms Revolution",
    "platform":"PC",
    "score":8.5,
    "genre":"Strategy",
    "editors_choice":"N"
  },
  {
    "title":"Worms Revolution",
    "platform":"Xbox 360",
    "score":8.5,
    "genre":"Strategy",
    "editors_choice":"N"
  },
  {
    "title":"Bad Piggies",
    "platform":"iPhone",
    "score":9.2,
    "genre":"Action",
    "editors_choice":"Y"
  },
  {
    "title":"Resident Evil 6",
    "platform":"PlayStation 3",
    "score":7.9,
    "genre":"Action, Adventure",
    "editors_choice":"N"
  },
  {
    "title":"Resident Evil 6",
    "platform":"Xbox 360",
    "score":7.9,
    "genre":"Action, Adventure",
    "editors_choice":"N"
  },
  {
    "title":"Shad'O",
    "platform":"PC",
    "score":7.0,
    "genre":"Adventure",
    "editors_choice":"N"
  },
  {
    "title":"Demon's Score",
    "platform":"iPhone",
    "score":6.9,
    "genre":"Action",
    "editors_choice":"N"
  },
  {
    "title":"NBA 2K13",
    "platform":"Xbox 360",
    "score":9.1,
    "genre":"Sports",
    "editors_choice":"Y"
  },
  {
    "title":"Counter-Strike: Global Offensive",
    "platform":"PC",
    "score":8.0,
    "genre":"Shooter",
    "editors_choice":"N"
  },
  {
    "title":"The World Ends with You: Solo Remix",
    "platform":"iPad",
    "score":9.5,
    "genre":"RPG",
    "editors_choice":"Y"
  },
  {
    "title":"Counter-Strike: Global Offensive",
    "platform":"PlayStation 3",
    "score":8.0,
    "genre":"Shooter",
    "editors_choice":"N"
  },
  {
    "title":"The World Ends with You: Solo Remix",
    "platform":"iPhone",
    "score":9.5,
    "genre":"RPG",
    "editors_choice":"Y"
  },
  {
    "title":"Counter-Strike: Global Offensive",
    "platform":"Xbox 360",
    "score":8.0,
    "genre":"Shooter",
    "editors_choice":"N"
  },
  {
    "title":"Madden NFL 13",
    "platform":"PlayStation Vita",
    "score":6.0,
    "genre":"Sports",
    "editors_choice":"N"
  },
  {
    "title":"Madden NFL 13",
    "platform":"PlayStation 3",
    "score":9.0,
    "genre":"Sports",
    "editors_choice":"Y"
  },
  {
    "title":"Madden NFL 13",
    "platform":"Xbox 360",
    "score":9.0,
    "genre":"Sports",
    "editors_choice":"Y"
  },
  {
    "title":"Hoodwink",
    "platform":"PC",
    "score":2.5,
    "genre":"Adventure",
    "editors_choice":"N"
  },
  {
    "title":"NBA 2K13",
    "platform":"PlayStation 3",
    "score":9.1,
    "genre":"Sports",
    "editors_choice":"Y"
  },
  {
    "title":"NBA 2K13",
    "platform":"PC",
    "score":9.1,
    "genre":"Sports",
    "editors_choice":"Y"
  },
  {
    "title":"Lili: Child of Geos",
    "platform":"iPhone",
    "score":7.0,
    "genre":"Adventure",
    "editors_choice":"N"
  },
  {
    "title":"Marvel vs. Capcom Origins",
    "platform":"Xbox 360",
    "score":8.2,
    "genre":"Fighting",
    "editors_choice":"N"
  },
  {
    "title":"Marvel vs. Capcom Origins",
    "platform":"PlayStation 3",
    "score":8.2,
    "genre":"Fighting",
    "editors_choice":"N"
  },
  {
    "title":"Dead or Alive 5",
    "platform":"PlayStation 3",
    "score":8.8,
    "genre":"Fighting",
    "editors_choice":"N"
  },
  {
    "title":"Dead or Alive 5",
    "platform":"Xbox 360",
    "score":8.8,
    "genre":"Fighting",
    "editors_choice":"N"
  },
  {
    "title":"Medal of Honor Warfighter",
    "platform":"PC",
    "score":4.0,
    "genre":"Shooter",
    "editors_choice":"N"
  },
  {
    "title":"Professor Layton and the Miracle Mask",
    "platform":"Nintendo 3DS",
    "score":8.7,
    "genre":"Adventure",
    "editors_choice":"Y"
  },
  {
    "title":"Hotline Miami",
    "platform":"PC",
    "score":8.8,
    "genre":"Action",
    "editors_choice":"Y"
  },
  {
    "title":"Edna & Harvey: Harvey's New Eyes",
    "platform":"PC",
    "score":6.0,
    "genre":"Adventure",
    "editors_choice":"N"
  },
  {
    "title":"Medal of Honor Warfighter",
    "platform":"PlayStation 3",
    "score":4.0,
    "genre":"Shooter",
    "editors_choice":"N"
  },
  {
    "title":"Medal of Honor Warfighter",
    "platform":"Xbox 360",
    "score":4.0,
    "genre":"Shooter",
    "editors_choice":"N"
  },
  {
    "title":"Transformers: Fall of Cybertron",
    "platform":"Xbox 360",
    "score":8.5,
    "genre":"Shooter",
    "editors_choice":"N"
  },
  {
    "title":"Transformers: Fall of Cybertron",
    "platform":"PlayStation 3",
    "score":8.5,
    "genre":"Shooter",
    "editors_choice":"N"
  },
  {
    "title":"Hero Academy",
    "platform":"PC",
    "score":9.0,
    "genre":"Board",
    "editors_choice":"Y"
  },
  {
    "title":"Hero Academy",
    "platform":"iPhone",
    "score":9.0,
    "genre":"Strategy",
    "editors_choice":"Y"
  },
  {
    "title":"Puzzle Craft",
    "platform":"iPhone",
    "score":9.0,
    "genre":"Puzzle",
    "editors_choice":"Y"
  },
  {
    "title":"Realms Of Ancient War",
    "platform":"Xbox 360",
    "score":5.5,
    "genre":"Action",
    "editors_choice":"N"
  },
  {
    "title":"Realms Of Ancient War",
    "platform":"PlayStation 3",
    "score":5.5,
    "genre":"Action",
    "editors_choice":"N"
  },
  {
    "title":"Anomaly: Warzone Earth",
    "platform":"PlayStation 3",
    "score":8.2,
    "genre":"Action",
    "editors_choice":"N"
  },
  {
    "title":"Darksiders II",
    "platform":"PC",
    "score":7.5,
    "genre":"Action",
    "editors_choice":"N"
  },
  {
    "title":"Left 4 Dead 2: Cold Stream",
    "platform":"Macintosh",
    "score":7.0,
    "genre":"Shooter",
    "editors_choice":"N"
  },
  {
    "title":"Left 4 Dead 2: Cold Stream",
    "platform":"PC",
    "score":7.0,
    "genre":"Shooter",
    "editors_choice":"N"
  },
  {
    "title":"Puzzle Craft",
    "platform":"Android",
    "score":9.0,
    "genre":"Puzzle",
    "editors_choice":"Y"
  },
  {
    "title":"Left 4 Dead 2: Cold Stream",
    "platform":"Xbox 360",
    "score":7.0,
    "genre":"Shooter",
    "editors_choice":"N"
  },
  {
    "title":"Horn",
    "platform":"iPhone",
    "score":9.0,
    "genre":"Action, Adventure",
    "editors_choice":"Y"
  },
  {
    "title":"Forza Horizon",
    "platform":"Xbox 360",
    "score":9.0,
    "genre":"Racing",
    "editors_choice":"Y"
  },
  {
    "title":"FIFA Soccer 13",
    "platform":"PlayStation Vita",
    "score":4.0,
    "genre":"Sports",
    "editors_choice":"N"
  },
  {
    "title":"Mugen Souls",
    "platform":"PlayStation 3",
    "score":3.9,
    "genre":"Strategy, RPG",
    "editors_choice":"N"
  },
  {
    "title":"Crazy Taxi",
    "platform":"iPhone",
    "score":7.1,
    "genre":"Racing, Action",
    "editors_choice":"N"
  },
  {
    "title":"New Little King's Story",
    "platform":"PlayStation Vita",
    "score":5.8,
    "genre":"RPG",
    "editors_choice":"N"
  },
  {
    "title":"Fable: The Journey",
    "platform":"Xbox 360",
    "score":7.2,
    "genre":"Action, RPG",
    "editors_choice":"N"
  },
  {
    "title":"The Lord of the Rings Online: Riders of Rohan",
    "platform":"PC",
    "score":8.3,
    "genre":"RPG",
    "editors_choice":"N"
  },
  {
    "title":"Doom 3: BFG Edition",
    "platform":"Xbox 360",
    "score":7.6,
    "genre":"RPG",
    "editors_choice":"N"
  },
  {
    "title":"Rugby League Live 2",
    "platform":"Xbox 360",
    "score":6.0,
    "genre":"Sports",
    "editors_choice":"N"
  },
  {
    "title":"Rugby League Live 2",
    "platform":"PlayStation 3",
    "score":6.0,
    "genre":"Sports",
    "editors_choice":"N"
  },
  {
    "title":"Doom 3: BFG Edition",
    "platform":"PlayStation 3",
    "score":7.6,
    "genre":"RPG",
    "editors_choice":"N"
  },
  {
    "title":"Punch Quest",
    "platform":"iPhone",
    "score":9.3,
    "genre":"Action",
    "editors_choice":"Y"
  }
];




var aMasterData = [];
var aNewFilteredData = [];
var aTableColumnList = ["title", "platform", "score", "genre", "editors_choice"];
var aTableColumnHeaderLabels = ["Title", "Platform", "Score", "Genre", "Editor's Choice"];
var aSelectedFilter = [];
var sSearchValue = "";
var oHeaderCellSortOptions = {
  type: "",
  sortOrder: ""
};

$(document).ready(function () {
  /*$.ajax({
    url: "http://starlord.hackerearth.com/gamesarena",
    success: function (aResult) {
      fillData(aResult);
    },
    error: function (XMLHttpRequest, textStatus, errorThrown) {
      console.log("Static Data will be used");
      var aData = aStaticMasterData;
      fillData(aData);
    }
  });*/
  var aData = aStaticMasterData;
      fillData(aData);
});

var fillData = function (aResult) {
  aResult.splice(0, 1);
  aMasterData = aResult;
  aNewFilteredData = aMasterData;
  createTableStructure(aMasterData);
  createFilterPanel();
};

var handleSearchBoxKeyDown = function (oEvent) {
  var iKeyCode = oEvent.keyCode;
  if (iKeyCode == 13) {
    handleSearchBoxBlur();
  }
};

var handleSearchBoxBlur = function () {
  var oInputDom = document.getElementById('searchBarInput');
  sSearchValue = oInputDom.value;
  if (sSearchValue) {
    var bTypeFieldExists = false;
    var iTypeFieldIndex = 0;
    for (var i = 0; i < aSelectedFilter.length; i++) {
      var oSelectedFilter = aSelectedFilter[i];
      if (oSelectedFilter.type == "title") {
        bTypeFieldExists = true;
        iTypeFieldIndex = i;
        break;
      }
    }
    if (bTypeFieldExists) {
      aSelectedFilter.splice(iTypeFieldIndex, 1);
    }
    aSelectedFilter.push({type: "title", value: sSearchValue});

  } else {
    var iSpliceIndex = 0;
    for (var i = 0; i < aSelectedFilter.length; i++) {
      var oSelectedFilter = aSelectedFilter[i];
      if (oSelectedFilter.type == "title") {
        iSpliceIndex = i;
        break;
      }
    }
    aSelectedFilter.splice(iSpliceIndex, 1);
  }

  handleTableUpdate();
};

var createTableStructure = function (aData) {
  var oTableWrapper = document.getElementById("rightPanel");

  var oExistingTableWrapper = document.getElementById('tempTableWrapperId');
  if (oExistingTableWrapper) {
    oExistingTableWrapper.parentNode.removeChild(oExistingTableWrapper);
  }

  var oTempWrapperDiv = document.createElement('div');
  oTempWrapperDiv.setAttribute("class", "tempTableWrapper");
  oTempWrapperDiv.setAttribute("id", "tempTableWrapperId");


  var oSearchBarWrapper = document.createElement('div');
  oSearchBarWrapper.setAttribute("class", "searchBarWrapper");
  var oSearchIcon = document.createElement('div');
  oSearchIcon.setAttribute("class", "searchBarIcon");
  oSearchBarWrapper.appendChild(oSearchIcon);
  var oSearchInput = document.createElement('input');
  oSearchInput.setAttribute("class", "searchBarInput");
  oSearchInput.setAttribute("id", "searchBarInput");
  oSearchInput.onblur = handleSearchBoxBlur;
  oSearchInput.onkeydown = handleSearchBoxKeyDown;
  oSearchBarWrapper.appendChild(oSearchInput);
  oTempWrapperDiv.appendChild(oSearchBarWrapper);


  var oTableDOM = document.createElement('table');
  oTableDOM.setAttribute("id", "appTable");
  oTableDOM.setAttribute("style", "width: 100%");
  oTableDOM.setAttribute("cellspacing", "0");
  oTableDOM.setAttribute("cellpadding", "0");

  var oTHead = oTableDOM.createTHead();
  var oHeadRow = oTHead.insertRow(0);
  for (var i = 0; i < aTableColumnList.length; i++) {
    var oHeadCell = oHeadRow.insertCell(i);
    var oHeaderCellInnerContainer = document.createElement('div');
    oHeaderCellInnerContainer.setAttribute("class", "headerCellInnerContainer");

    var oHeaderCellSortOrder = document.createElement('div');
    oHeaderCellSortOrder.setAttribute("class", "sortOption");
    if (aTableColumnList[i] == oHeaderCellSortOptions.type) {
      oHeaderCellSortOrder.className += " visible";
      oHeaderCellSortOrder.className += " " + oHeaderCellSortOptions.sortOrder;
    } else {
      oHeaderCellSortOrder.className += " asc";
    }
    // oHeaderCellSortOrder.setAttribute("title", "sortOption");
    oHeaderCellSortOrder.onclick = handleSortOptionCLicked.bind(this, aTableColumnList[i]);

    var oHeaderCellLabel = document.createElement('div');
    oHeaderCellLabel.innerHTML = "<b>" + aTableColumnHeaderLabels[i] + "</b>";
    oHeaderCellLabel.setAttribute("class", "headerLabel");

    oHeaderCellInnerContainer.appendChild(oHeaderCellSortOrder);
    oHeaderCellInnerContainer.appendChild(oHeaderCellLabel);

    oHeadCell.appendChild(oHeaderCellInnerContainer);
  }

  var oTBody = document.createElement("tbody");
  for (i = 0; i < aData.length; i++) {
    var oData = aData[i];
    var oRow = oTBody.insertRow(i);
    for (var j = 0; j < aTableColumnList.length; j++) {
      var oCell = oRow.insertCell(j);
      oCell.innerHTML = oData[aTableColumnList[j]];
    }
  }

  oTableDOM.appendChild(oTBody);
  oTempWrapperDiv.appendChild(oTableDOM);
  oTableWrapper.appendChild(oTempWrapperDiv);

  //update search input value
  document.getElementById("searchBarInput").value = sSearchValue;
};

var createFilterPanel = function () {
  var oRightPanel = document.getElementById('leftPanel');

  var oFilterUpperWrapper = document.createElement('div');
  oFilterUpperWrapper.setAttribute("id", "filterUpperWrapper");
  oRightPanel.appendChild(oFilterUpperWrapper);
  createRightPanelUpperPart();

  var oLowerPart = document.createElement("div");
  oLowerPart.setAttribute("id", "filterLowerWrapper");


  var oAddFilterButtonContainer = document.createElement('div');
  oAddFilterButtonContainer.setAttribute("class", "addFilterButtonContainer");
  var oAddFilterButton = document.createElement('button');
  oAddFilterButton.className = "addFilterButton";
  oAddFilterButton.innerHTML = "<b>Add Filter</b>";
  oAddFilterButton.onclick = function () {
    var bFilterCreationInProgress = !!document.getElementById("filterInput");
    if (bFilterCreationInProgress) {
      alert("Filter Creation is in progress. Please add the filter before adding new one.");
      return;
    }
    var aDropDownItems = [];
    if (aSelectedFilter.length) {
      for (var i = 0; i < aSelectedFilter.length; i++) {
        for (var j = 0; j < aTableColumnList.length; j++) {
          if (aSelectedFilter[i].type != aTableColumnList[j]) {
            aDropDownItems.push(aTableColumnList[j]);
          }
        }
      }
    } else {
      aDropDownItems = aTableColumnList;
    }

    var oDropDown = document.createElement('select');
    oDropDown.setAttribute("id", "filterSelect");
    for (i = 0; i < aDropDownItems.length; i++) {
      var oOption = document.createElement('option');
      oOption.setAttribute("value", aDropDownItems[i]);
      var t = document.createTextNode(aTableColumnHeaderLabels[i]);
      oOption.appendChild(t);
      oDropDown.appendChild(oOption);
    }
    oLowerPart.appendChild(oDropDown);

    var oInputDOM = document.createElement('input');
    oInputDOM.setAttribute("id", "filterInput");
    oLowerPart.appendChild(oInputDOM);

    var oPlusButton = document.createElement('button');
    oPlusButton.setAttribute("id", "filterPlus");
    oPlusButton.innerHTML = "<b> + </b>";
    oPlusButton.onclick = handleAddFilterOptionPlusClicked;
    oLowerPart.appendChild(oPlusButton);

  };
  oAddFilterButtonContainer.appendChild(oAddFilterButton);

  oLowerPart.appendChild(oAddFilterButtonContainer);
  oRightPanel.appendChild(oLowerPart);

};

var handleAddFilterOptionPlusClicked = function () {
  var oFilterSelectDom = document.getElementById("filterSelect");
  var sSelectedFilterColumn = oFilterSelectDom.value;

  var oFilterInput = document.getElementById('filterInput');
  var sUserInputValue = oFilterInput.value;

  aSelectedFilter.push({type: sSelectedFilterColumn, value: sUserInputValue});

  createRightPanelUpperPart();

  var oFilterPlusDom = document.getElementById("filterPlus");

  oFilterInput.parentNode.removeChild(oFilterInput);
  oFilterSelectDom.parentNode.removeChild(oFilterSelectDom);
  oFilterPlusDom.parentNode.removeChild(oFilterPlusDom);
};

var createRightPanelUpperPart = function () {
  var oFilterUpperWrapper = document.getElementById('filterUpperWrapper');

  var oExistingFilterUpper = document.getElementById('filterUpper');
  if (oExistingFilterUpper) {
    oExistingFilterUpper.parentNode.removeChild(oExistingFilterUpper);
  }

  var oUpperPart = document.createElement("div");
  oUpperPart.setAttribute("id", "filterUpper");

  for (var i = 0; i < aSelectedFilter.length; i++) {
    var oSelectedFilterContainer = document.createElement("div");
    oSelectedFilterContainer.setAttribute("class", "selectedFilterContainer");

    var oSelectedFilterType = document.createElement("div");
    oSelectedFilterType.setAttribute("class", "selectedFilterType");
    oSelectedFilterType.innerHTML = aSelectedFilter[i].type;

    var oSelectedFilterContains = document.createElement("div");
    oSelectedFilterContains.setAttribute("class", "selectedFilterContains");
    oSelectedFilterContains.innerHTML = "contains";

    var oSelectedFilterVal = document.createElement("div");
    oSelectedFilterVal.setAttribute("class", "selectedFilterVal");
    oSelectedFilterVal.innerHTML = aSelectedFilter[i].value;

    oSelectedFilterContainer.appendChild(oSelectedFilterType);
    oSelectedFilterContainer.appendChild(oSelectedFilterContains);
    oSelectedFilterContainer.appendChild(oSelectedFilterVal);

    oUpperPart.appendChild(oSelectedFilterContainer);
  }

  if (aSelectedFilter.length > 0) {
    var oButtonsContainer = document.createElement("div");
    oButtonsContainer.setAttribute("class", "filterButtonsContainer");

    var oUpdateButton = document.createElement("button");
    oUpdateButton.setAttribute("class", "filterUpdateButton");
    oUpdateButton.innerHTML = "<b> Update </b>";
    oUpdateButton.onclick = handleTableUpdate;
    oButtonsContainer.appendChild(oUpdateButton);

    var oClearButton = document.createElement("button");
    oClearButton.setAttribute("class", "filterClearButton");
    oClearButton.innerHTML = "<b> Clear </b>";
    oClearButton.onclick = function () {
      var oExistingFilterUpper = document.getElementById('filterUpper');
      if (oExistingFilterUpper) {
        oExistingFilterUpper.parentNode.removeChild(oExistingFilterUpper);
      }
      aSelectedFilter = [];
      createTableStructure(aMasterData);
    };
    oButtonsContainer.appendChild(oClearButton);

    oUpperPart.appendChild(oButtonsContainer);
  }

  oFilterUpperWrapper.appendChild(oUpperPart);
};

var handleTableUpdate = function () {
  var aListToDO = aNewFilteredData.length ? aNewFilteredData : aMasterData;
  for (var i = 0; i < aSelectedFilter.length; i++) {
    var oSelectedFilter = aSelectedFilter[i];
    aNewFilteredData = getFilteredDataList(aListToDO, oSelectedFilter);
  }
  if (aSelectedFilter.length) {
    createTableStructure(aNewFilteredData);
  } else {
    createTableStructure(aMasterData);
  }
};

var getFilteredDataList = function (aList, oSelectedFilter) {
  var aNewFilteredData = [];
  for (var j = 0; j < aList.length; j++) {
    var oData = aList[j];
    var sDataValue = oData[oSelectedFilter.type].toString().toLocaleLowerCase();
    if (sDataValue.includes(oSelectedFilter.value.toLocaleLowerCase())) {
      aNewFilteredData.push(oData);
    }
  }
  return aNewFilteredData;
};

var handleSortOptionCLicked = function (sType, oEvent) {
  oEvent.stopPropagation();

  if (oHeaderCellSortOptions.type == sType) {
    oHeaderCellSortOptions.sortOrder = oHeaderCellSortOptions.sortOrder == "asc" ? "desc" : "asc";
  } else {
    oHeaderCellSortOptions.type = sType;
    oHeaderCellSortOptions.sortOrder = "asc";
  }

  var aDataToSort = aNewFilteredData;
  var sSortParam = oHeaderCellSortOptions.sortOrder == "desc" ? "-" + oHeaderCellSortOptions.type : oHeaderCellSortOptions.type;
  aDataToSort.sort(dynamicSort(sSortParam));

  createTableStructure(aDataToSort);
};


var dynamicSort = function (property) {
  var sortOrder = 1;
  if (property[0] === "-") {
    sortOrder = -1;
    property = property.substr(1);
  }
  return function (a, b) {
    var result = (a[property] < b[property]) ? -1 : (a[property] > b[property]) ? 1 : 0;
    return result * sortOrder;
  }
};
